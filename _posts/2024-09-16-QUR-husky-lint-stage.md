---
title: ê¶ê¸ˆì¦ 1 - huskyì™€ lint-stage ì„¤ì • (in Nest.js)
date: 2024-09-16 10:20:00 +09:00
categories: [ê¶ê¸ˆì¦]
tags:
  [
    husky,
    commit,
    git,
    npm
  ]
---
# Nest.js ì— husky + lint-stage ì„¤ì •


### huskyë¥¼ ì‚¬ìš©í•´ë³´ëŠ” ì´ìœ 

- ê°œë°œìë“¤ê³¼ì˜ í˜‘ì—… ê³¼ì •ì— ìˆì–´ì„œ ì„¤ì •í•´ì„œ ê°œë°œìë“¤ì´ í¸í•´ì§ˆ ìˆ˜ ìˆëŠ” ë°©ë²•ì€ ê°€ëŠ¥í•œ ë‹¤ ì‹œë„í•´ë³´ê³  ì‹¶ì—ˆë‹¤.
- BE ë¦¬ë“œë¥¼ ë§¡ê²Œ ëœ ì´ìƒ, ì„¸íŒ…ì€ ë‚˜ì˜ ì˜ì—­ì´ë¼ëŠ” ë§ˆìŒì— huskyë„ ì‚¬ìš©í•´ë³´ê²Œ ëë‹¤.
- ì´ì „ í”„ë¡œì íŠ¸ì™€ ì§€ê¸ˆ ì§„í–‰ì¤‘ì¸ í”„ë¡œì íŠ¸ì—ì„œ FE ë¦¬ë“œ ë¶„ì´ huskyë¥¼ ì„¸íŒ…í•´ì£¼ì…¨ëŠ”ë°,
ì‚¬ìš©í•´ë³´ë‹ˆ ì‹¤ì œë¡œ ë‚´ê°€ í¸í•˜ë‹¤ëŠ” ëŠë‚Œì„ ë°›ì•˜ë‹¤.
- ì„¸íŒ… ë°©ë²•ì´ ê¶ê¸ˆí–ˆë‹¤!

### husky ë€?

> Husky enhances your commits and more ğŸ¶Â *woof!*
Automatically lint yout commit messages, code, and run tests upon committing or pushing
[- husky github-](https://typicode.github.io/husky/)
> 

husky ê³µì‹ë¬¸ì„œì— ë”°ë¥´ë©´, huskyëŠ” ì»¤ë°‹ ë˜ëŠ” í‘¸ì‹œì— ë”°ë¥¸ ì½”ë“œ, ì»¤ë°‹ ë©”ì„¸ì§€, í…ŒìŠ¤íŠ¸ë¥¼ ìë™ lint í•´ì£¼ëŠ” ì—­í• ì´ë‹¤. ë¼ê³  ì“°ì—¬ì ¸ ìˆë‹¤.

### lint-stage ê¹Œì§€ ì„¤ì •í•œ ì´ìœ 

- [lint-stage](https://github.com/lint-staged/lint-staged)

ì‹¤ì œ lintê°€ ì»¤ë°‹ í•  ë•Œ ë§ˆë‹¤ ëª¨ë“  ì½”ë“œì— ì‘ë™í•˜ê²Œ ë˜ë©´, ì „ì²´ íŒŒì¼ì„ í™•ì¸í•˜ê³  

lintì‘ì—…ì„ ì§„í–‰í•˜ê¸° ë•Œë¬¸ì— ì†ë„ê°€ ëŠë¦¬ë‹¤.

lint-stage ëŠ” ë‚´ê°€ ì›í•˜ëŠ” íŒŒì¼ (ë³€ê²½ëœ íŒŒì¼) ë§Œ íŠ¹ì •í•´ì„œ lintë¥¼ ì§„í–‰ ì‹œí‚¤ëŠ” ë™ì‘ì„ í•˜ê¸° ë•Œë¬¸ì—

íŒ€ì›ë“¤ì˜ commitì— ë” ì¢‹ì€ ì˜í–¥ì„ ì£¼ê¸° ìœ„í•´ì„œ ì ìš©í•˜ê²Œ ë˜ì—ˆë‹¤.

## ì„¤ì • ë°©ë²•

- ëª¨ë“  ê³¼ì •ì€ eslint ì™€ prettier ê°€ ì„¤ì •ë˜ì—ˆë‹¤ëŠ” ì „ì œì— ìˆ˜í–‰í•œë‹¤!

### 1. npm ì„¤ì¹˜

- husky ì„¤ì¹˜

```bash
# npm
npm install --save-dev husky

# yarn
yarn add --dev husky

# pnpm
pnpm add --save-dev husky
```

- husky init

```bash
# npm
npx husky init

#pnpm
pnpm exec husky init
```

í˜„ì¬ ìµœì‹  ë²„ì „ì˜ huskyëŠ” ê¸°ì¡´ì˜ husky ë°©ì‹ ì²˜ëŸ¼ husky.shë¥¼ ì´ìš©í•œ ë°©ì‹ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³ ,

.husky í´ë” ë‚´ë¶€ì˜ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ë“¤ (pre-commit, commit-msgë“±) ì„ ì§ì ‘ ìˆ˜í–‰í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë³€ê²½

ë˜ì—ˆë‹¤.

- husky ë””ë ‰í† ë¦¬ ìƒì„±
    
    ```bash
    npx husky install
    ```
    
    - í•´ë‹¹ ëª…ë ¹ì„ ìˆ˜í–‰í•˜ë©´, git hooks ë¥¼ í•´ë‹¹ í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ì—ì„œ ê´€ë¦¬í•˜ê²Œ ëœë‹¤.

### 2. package.json ìŠ¤í¬ë¦½íŠ¸ ì„¤ì •

- npx husky init, ë˜ëŠ” npx husky install ì„ ìˆ˜í–‰í•˜ë©´ Package.jsonì— postinstall ìŠ¤í¬ë¦½íŠ¸ê°€ ì¶”ê°€ ëœë‹¤.
    
    ```json
    "scripts" : {
    	"postinstall" : "husky install"
    }
    ```
    

### 3. pre-commit ì‘ì„±

- git hook ì„ ì´ìš©í•˜ì—¬, commit ì— ëŒ€í•´ huskyë¥¼ í†µí•œ ì‘ì—…ì„ ìˆ˜í–‰ í•  ìˆ˜ ìˆë‹¤.
- pre-commit íŒŒì¼ì€ ì»¤ë°‹ ì „, ì½”ë“œ ìŠ¤íƒ€ì¼ì„ ê²€ì‚¬í•˜ê±°ë‚˜ lintë¥¼ ìˆ˜í–‰í•˜ëŠ” ë“±ì˜ ì‘ì—…ì„ í•˜ëŠ” ë™ì‘ì„ ì ëŠ” ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì´ë‹¤.

- íŒŒì¼ ì¶”ê°€ë°©ë²•
    1. npx ë¡œ ì¶”ê°€
        
        ```bash
        npx husky add .husky/pre-commit "npm run lint"
        ```
        
    2. ìˆ˜ë™ ì¶”ê°€
        - ìƒì„±ëœ í”„ë¡œì íŠ¸ root ê²½ë¡œì˜ .husky í´ë”ì— â€˜pre-commitâ€™ ì´ë¼ëŠ” íŒŒì¼ì„ ìƒì„±
        - ë‚´ë¶€ì— ëª…ë ¹ì–´ë¥¼ ì‘ì„±
            
            ```bash
            #!/bin/sh
            
            npm run lint
            ```
            

- ì‹¤ì œ ë‚´ê°€ ì‘ì„±í•œ pre-commit
    
    ```bash
    #!/bin/sh
    
    FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.ts$' | sed 's/\\/\//g')
    
    echo "ë³€ê²½ëœ íŒŒì¼ ëª©ë¡: $FILES"
    
    if [ -z "$FILES" ]; then
      echo "ë³€ê²½ëœ TypeScript íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤."
      exit 0
    fi
    
    echo "ESLint ì‹¤í–‰ ì¤‘..."
    RESULT=$(npx eslint $FILES --format stylish --fix)
    
    echo "$RESULT"
    
    if echo "$RESULT" | grep -q 'error'; then
      echo "Lint ì—ëŸ¬ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì»¤ë°‹ì„ ì¤‘ë‹¨í•©ë‹ˆë‹¤."
    
      echo "ë‹¤ìŒì€ Lint ì—ëŸ¬ê°€ ë°œìƒí•œ íŒŒì¼ ë° ìƒì„¸ í•­ëª©ì…ë‹ˆë‹¤:"
      echo "$RESULT" | grep -E 'error|^\s+\d+:\d+'
    
      exit 1
    else
      echo "Lintì— ì í•©í•©ë‹ˆë‹¤. ì»¤ë°‹ì„ ê³„ì† ì§„í–‰í•©ë‹ˆë‹¤."
      exit 0
    fi
    
    ```
    
    1. ë³€ê²½ ëœ íŒŒì¼ ì¤‘ .ts í™•ì¥ì ì¸ íŒŒì¼ë§Œ FILES ë¼ëŠ” ë³€ìˆ˜ì— ë„£ëŠ”ë‹¤. 
        1. ìš´ì˜ì²´ì œì— ë”°ë¥¸ ê²½ë¡œ í‘œì‹œê°€ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— /, \ ë‘˜ë‹¤ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
        2. FILESê°€ ë¹„ì–´ìˆìœ¼ë©´ í•´ë‹¹ ê³¼ì •ì„ ê·¸ëƒ¥ pass
    2. FILESì— ë“¤ì–´ê°„ ë³€ê²½ëœ íŒŒì¼ë“¤ì„ ëŒ€ìƒìœ¼ë¡œ Lint ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•œë‹¤.
        1. Lint ê²€ì‚¬ ìƒ ìœ„ë°°ëœ ê·œì¹™ì´ ì—†ìœ¼ë©´ ì •ìƒ pass â‡’ commit ë‹¨ê³„ë¡œ ê°„ë‹¤.
        2. Lint ê²€ì‚¬ ìƒ ìœ„ë°°ëœ ê·œì¹™ì´ ë°œìƒí•˜ë©´, Lintì—ëŸ¬ ë©”ì„¸ì§€ë¥¼ ì¶œë ¥ í›„ ì¢…ë£Œ â‡’ commit ì·¨ì†Œ

### 4. commit-msg ì‘ì„±

- commit-msg íŒŒì¼ì€ ì»¤ë°‹ì„ ìˆ˜í–‰í•  ë•Œ huskyë¥¼ í†µí•´ ìˆ˜í–‰í•  ì‘ì—…ì— ëŒ€í•œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ëŠ” ê³³
- ì»¤ë°‹ ë©”ì„¸ì§€ íŒ¨í„´
    - `[ì˜ì–´ ì†Œë¬¸ì]` : `[ì˜ì–´, í•œê¸€, í•˜ì´í”ˆ ì‚¬ìš©ê°€ëŠ¥]`

- ì‹¤ì œ ì‚¬ìš© ìŠ¤í¬ë¦½íŠ¸
    
    ```bash
    #!/bin/sh
    
    commit_msg_file=$1
    commit_msg=$(cat "$commit_msg_file")
    
    PATTERN='^[a-z]+ : [a-zê°€-í£\- ]+$'
    
    if ! echo "$commit_msg" | awk "/$PATTERN/" > /dev/null; then
      echo "ì»¤ë°‹ ì–‘ì‹ì„ ì§€ì¼œì£¼ì„¸ìš”'"
      exit 1
    fi
    
    echo "ì»¤ë°‹ ë©”ì‹œì§€ê°€ íŒ¨í„´ì— ë§ìŠµë‹ˆë‹¤"
    
    ```
    

### 5. lint-stage ì„¤ì •

- ì„¤ì¹˜
    
    ```bash
    npm install lint-staged --save-dev
    ```
    
- package.json ë‚´ ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€
    
    ```json
    	"lint-staged": {
    		"*.ts": [
    			"eslint --max-warnings=0 --fix",
    			"prettier --write",
    			"git add"
    		]
    	}
    ```
    
    1. eslint ë¥¼ ìˆ˜í–‰ í›„, ë°œê²¬ëœ ìœ„ë°˜ ì‚¬í•­ì´ ì—†ì„ ë•Œ í†µê³¼
    2. prettier ìˆ˜í–‰
    3. git add ìˆ˜í–‰

### ê²°ê³¼

ì‹¤ì œ lint-stage ì„¤ì •ê³¼ pre-commit ì˜ ì½”ë“œ ë‚´ìš©ì„ í™•ì¸í•´ë³´ë©´

npx eslint ë¥¼ ë³€ê²½ëœ íŒŒì¼ë“¤ì— ëŒ€í•´ì„œ ìˆ˜í–‰í•˜ê²Œ ëœë‹¤.

ë³€ê²½ëœ íŒŒì¼ë“¤ ì¤‘ Lint ê·œì¹™ì„ ìœ„ë°°í•˜ëŠ” íŒŒì¼ì´ ì—†ë‹¤ë©´,

git add ë° ê¸°ì¡´ commit ì— ëŒ€í•œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê²Œ ë˜ë©´

ì´ë•Œ commit-msgì˜ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ëœë‹¤.

(ì»¤ë°‹ ë©”ì‹œì§€ íŒ¨í„´ì— ë§ì§€ ì•Šìœ¼ë©´ ì»¤ë°‹ ì·¨ì†Œ)

### ìš”ì•½

- husky ê³¼ lint-staged ë¥¼ ì‚¬ìš©í•´ì„œ commit ì‹œ ë³€ê²½ëœ íŒŒì¼ì— ëŒ€í•´ì„œë§Œ lintë° íŠ¹ì • ì‘ì—…ì„ ìˆ˜í–‰
- ëª¨ë“  ê³¼ì •ì€ chatGPT ë§Œì„ ì´ìš©í•´ì„œ ì‘ì—… í–ˆë‹¤.
    - ë¸”ë¡œê·¸ ê¸€ë“¤ì´ ëª¨ë‘ ê°™ì€ ë‚´ìš©ì´ê¸°ì— ê¶ê¸ˆí•´ì„œ gptë¡œë§Œ í•´ë´¤ë‹¤.

- [gpt ëŒ€í™” ë‚´ìš© ë§í¬](https://chatgpt.com/share/66e70e90-91f0-8006-9738-fceddb805fd1)